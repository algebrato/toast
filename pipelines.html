<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Pipelines &mdash; PyTOAST 2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PyTOAST 2.0 documentation" href="index.html" />
    <link rel="next" title="Data Distribution" href="dist.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>PyTOAST 2.0 documentation</span></a></h1>
        <h2 class="heading"><span>Pipelines</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="install.html">Installation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="dist.html">Data Distribution</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="pipelines">
<span id="id1"></span><h1>Pipelines<a class="headerlink" href="#pipelines" title="Permalink to this headline">¶</a></h1>
<p>Before delving into the structure of the pytoast package, it is sometimes
useful to look at (and use!) an example.  One such program is the simple script
below which simulates a fake satellite scanning strategy with a focalplane of
detectors and then makes a map.</p>
<div class="section" id="simple-satellite-simulation">
<h2>Simple Satellite Simulation<a class="headerlink" href="#simple-satellite-simulation" title="Permalink to this headline">¶</a></h2>
<p>The current version of this tool simulates parameterized boresight pointing
and then uses the given focalplane (loaded from a pickle file) to compute
the detector pointing.  Noise properties of each detector are used to
simulate noise timestreams.</p>
<p>In order to create a focalplane file, you can do for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">fake</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fake</span><span class="p">[</span><span class="s1">&#39;quat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">fake</span><span class="p">[</span><span class="s1">&#39;fwhm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">fake</span><span class="p">[</span><span class="s1">&#39;fknee&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.05</span>
<span class="n">fake</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">fake</span><span class="p">[</span><span class="s1">&#39;NET&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.000060</span>
<span class="n">fake</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
<span class="n">fp</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">fp</span><span class="p">[</span><span class="s1">&#39;bore&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fake</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;fp_lb.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that until the older TOAST mapmaking tools are ported, this script
requires the use of libmadam (the &#8211;madam option).:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">toast_satellite_sim</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">samplerate</span> <span class="n">SAMPLERATE</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">spinperiod</span> <span class="n">SPINPERIOD</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">spinangle</span> <span class="n">SPINANGLE</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">precperiod</span> <span class="n">PRECPERIOD</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">precangle</span> <span class="n">PRECANGLE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">hwprpm</span> <span class="n">HWPRPM</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">hwpstep</span> <span class="n">HWPSTEP</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">hwpsteptime</span> <span class="n">HWPSTEPTIME</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">obs</span> <span class="n">OBS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">gap</span> <span class="n">GAP</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">numobs</span> <span class="n">NUMOBS</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">obschunks</span> <span class="n">OBSCHUNKS</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">debug</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">nside</span> <span class="n">NSIDE</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">baseline</span> <span class="n">BASELINE</span><span class="p">]</span>
                              <span class="p">[</span><span class="o">--</span><span class="n">noisefilter</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">madam</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">fp</span> <span class="n">FP</span><span class="p">]</span>

<span class="n">Simulate</span> <span class="n">satellite</span> <span class="n">boresight</span> <span class="n">pointing</span> <span class="ow">and</span> <span class="n">make</span> <span class="n">a</span> <span class="n">noise</span> <span class="nb">map</span><span class="o">.</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">samplerate</span> <span class="n">SAMPLERATE</span>
                        <span class="n">Detector</span> <span class="n">sample</span> <span class="n">rate</span> <span class="p">(</span><span class="n">Hz</span><span class="p">)</span>
  <span class="o">--</span><span class="n">spinperiod</span> <span class="n">SPINPERIOD</span>
                        <span class="n">The</span> <span class="n">period</span> <span class="p">(</span><span class="ow">in</span> <span class="n">minutes</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">rotation</span> <span class="n">about</span> <span class="n">the</span> <span class="n">spin</span>
                        <span class="n">axis</span>
  <span class="o">--</span><span class="n">spinangle</span> <span class="n">SPINANGLE</span>
                        <span class="n">The</span> <span class="n">opening</span> <span class="n">angle</span> <span class="p">(</span><span class="ow">in</span> <span class="n">degrees</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">boresight</span> <span class="kn">from</span>
                        <span class="nn">the</span> <span class="n">spin</span> <span class="n">axis</span>
  <span class="o">--</span><span class="n">precperiod</span> <span class="n">PRECPERIOD</span>
                        <span class="n">The</span> <span class="n">period</span> <span class="p">(</span><span class="ow">in</span> <span class="n">minutes</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">rotation</span> <span class="n">about</span> <span class="n">the</span>
                        <span class="n">precession</span> <span class="n">axis</span>
  <span class="o">--</span><span class="n">precangle</span> <span class="n">PRECANGLE</span>
                        <span class="n">The</span> <span class="n">opening</span> <span class="n">angle</span> <span class="p">(</span><span class="ow">in</span> <span class="n">degrees</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">spin</span> <span class="n">axis</span> <span class="kn">from</span>
                        <span class="nn">the</span> <span class="n">precession</span> <span class="n">axis</span>
  <span class="o">--</span><span class="n">hwprpm</span> <span class="n">HWPRPM</span>       <span class="n">The</span> <span class="n">rate</span> <span class="p">(</span><span class="ow">in</span> <span class="n">RPM</span><span class="p">)</span> <span class="n">of</span> <span class="n">the</span> <span class="n">HWP</span> <span class="n">rotation</span>
  <span class="o">--</span><span class="n">hwpstep</span> <span class="n">HWPSTEP</span>     <span class="n">For</span> <span class="n">stepped</span> <span class="n">HWP</span><span class="p">,</span> <span class="n">the</span> <span class="n">angle</span> <span class="ow">in</span> <span class="n">degrees</span> <span class="n">of</span> <span class="n">each</span> <span class="n">step</span>
  <span class="o">--</span><span class="n">hwpsteptime</span> <span class="n">HWPSTEPTIME</span>
                        <span class="n">For</span> <span class="n">stepped</span> <span class="n">HWP</span><span class="p">,</span> <span class="n">the</span> <span class="n">the</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">seconds</span> <span class="n">between</span> <span class="n">steps</span>
  <span class="o">--</span><span class="n">obs</span> <span class="n">OBS</span>             <span class="n">Number</span> <span class="n">of</span> <span class="n">hours</span> <span class="ow">in</span> <span class="n">one</span> <span class="n">science</span> <span class="n">observation</span>
  <span class="o">--</span><span class="n">gap</span> <span class="n">GAP</span>             <span class="n">Cooler</span> <span class="n">cycle</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">hours</span> <span class="n">between</span> <span class="n">science</span> <span class="n">obs</span>
  <span class="o">--</span><span class="n">numobs</span> <span class="n">NUMOBS</span>       <span class="n">Number</span> <span class="n">of</span> <span class="n">complete</span> <span class="n">observations</span>
  <span class="o">--</span><span class="n">obschunks</span> <span class="n">OBSCHUNKS</span>
                        <span class="n">Number</span> <span class="n">of</span> <span class="n">chunks</span> <span class="n">to</span> <span class="n">subdivide</span> <span class="n">each</span> <span class="n">observation</span> <span class="n">into</span>
                        <span class="k">for</span> <span class="n">data</span> <span class="n">distribution</span>
  <span class="o">--</span><span class="n">outdir</span> <span class="n">OUTDIR</span>       <span class="n">Output</span> <span class="n">directory</span>
  <span class="o">--</span><span class="n">debug</span>               <span class="n">Write</span> <span class="n">diagnostics</span>
  <span class="o">--</span><span class="n">nside</span> <span class="n">NSIDE</span>         <span class="n">Healpix</span> <span class="n">NSIDE</span>
  <span class="o">--</span><span class="n">baseline</span> <span class="n">BASELINE</span>   <span class="n">Destriping</span> <span class="n">baseline</span> <span class="n">length</span> <span class="p">(</span><span class="n">seconds</span><span class="p">)</span>
  <span class="o">--</span><span class="n">noisefilter</span>         <span class="n">Destripe</span> <span class="k">with</span> <span class="n">the</span> <span class="n">noise</span> <span class="nb">filter</span> <span class="n">enabled</span>
  <span class="o">--</span><span class="n">madam</span>               <span class="n">If</span> <span class="n">specified</span><span class="p">,</span> <span class="n">use</span> <span class="n">libmadam</span> <span class="k">for</span> <span class="nb">map</span><span class="o">-</span><span class="n">making</span>
  <span class="o">--</span><span class="n">fp</span> <span class="n">FP</span>               <span class="n">Pickle</span> <span class="n">file</span> <span class="n">containing</span> <span class="n">a</span> <span class="n">dictionary</span> <span class="n">of</span> <span class="n">detector</span>
                        <span class="n">properties</span><span class="o">.</span> <span class="n">The</span> <span class="n">keys</span> <span class="n">of</span> <span class="n">this</span> <span class="nb">dict</span> <span class="n">are</span> <span class="n">the</span> <span class="n">detector</span>
                        <span class="n">names</span><span class="p">,</span> <span class="ow">and</span> <span class="n">each</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">also</span> <span class="n">a</span> <span class="n">dictionary</span> <span class="k">with</span> <span class="n">keys</span>
                        <span class="s2">&quot;quat&quot;</span> <span class="p">(</span><span class="mi">4</span> <span class="n">element</span> <span class="n">ndarray</span><span class="p">),</span> <span class="s2">&quot;fwhm&quot;</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">arcmin</span><span class="p">),</span>
                        <span class="s2">&quot;fknee&quot;</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">Hz</span><span class="p">),</span> <span class="s2">&quot;alpha&quot;</span> <span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="ow">and</span> <span class="s2">&quot;NET&quot;</span>
                        <span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span> <span class="n">For</span> <span class="n">optional</span> <span class="n">plotting</span><span class="p">,</span> <span class="n">the</span> <span class="n">key</span> <span class="s2">&quot;color&quot;</span> <span class="n">can</span>
                        <span class="n">specify</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">matplotlib</span> <span class="n">color</span> <span class="n">string</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="example-proposed-core-satellite-boresight">
<h2>Example:  Proposed CoRE Satellite Boresight<a class="headerlink" href="#example-proposed-core-satellite-boresight" title="Permalink to this headline">¶</a></h2>
<p>TODO</p>
</div>
<div class="section" id="example-proposed-litebird-satellite-boresight">
<h2>Example:  Proposed LiteBIRD Satellite Boresight<a class="headerlink" href="#example-proposed-litebird-satellite-boresight" title="Permalink to this headline">¶</a></h2>
<p>TODO</p>
</div>
<div class="section" id="creating-your-own-pipeline">
<h2>Creating Your Own Pipeline<a class="headerlink" href="#creating-your-own-pipeline" title="Permalink to this headline">¶</a></h2>
<p>PyTOAST is designed to give you tools to piece together your own data processing workflow.</p>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="install.html">Installation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="dist.html">Data Distribution</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2015-2016, Theodore Kisner, Reijo Keskitalo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>