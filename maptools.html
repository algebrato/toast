<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Map-making Tools &mdash; PyTOAST 2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PyTOAST 2.0 documentation" href="index.html" />
    <link rel="next" title="Using at NERSC" href="nersc.html" />
    <link rel="prev" title="Simulations" href="sim.html" /> 
  </head>
  <body role="document">
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>PyTOAST 2.0 documentation</span></a></h1>
        <h2 class="heading"><span>Map-making Tools</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="sim.html">Simulations</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="nersc.html">Using at NERSC</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="map-making-tools">
<span id="maptools"></span><h1>Map-making Tools<a class="headerlink" href="#map-making-tools" title="Permalink to this headline">¶</a></h1>
<p>This broad class of operations include anything that generates pixel-space data products.</p>
<div class="section" id="distributed-pixel-space-data">
<h2>Distributed Pixel-space Data<a class="headerlink" href="#distributed-pixel-space-data" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="toast.map.OpLocalPixels">
<em class="property">class </em><code class="descclassname">toast.map.</code><code class="descname">OpLocalPixels</code><span class="sig-paren">(</span><em>pixels='pixels'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/pixels.html#OpLocalPixels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.OpLocalPixels" title="Permalink to this definition">¶</a></dt>
<dd><p>Operator which computes the set of locally hit pixels.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>pixels</strong> (<em>str</em>) &#8211; the name of the cache object (&lt;pixels&gt;_&lt;detector&gt;)
containing the pixel indices to use.</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="toast.map.OpLocalPixels.exec">
<code class="descname">exec</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/pixels.html#OpLocalPixels.exec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.OpLocalPixels.exec" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over all observations and detectors and compute local pixels.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<a class="reference internal" href="dist.html#toast.Data" title="toast.Data"><em>toast.Data</em></a>) &#8211; The distributed data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">An array of the locally hit pixel indices.</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">(array)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="toast.map.OpLocalPixels.timedist">
<code class="descname">timedist</code><a class="headerlink" href="#toast.map.OpLocalPixels.timedist" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(bool)</em> &#8211; Whether this operator requires data that time-distributed.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="toast.map.DistPixels">
<em class="property">class </em><code class="descclassname">toast.map.</code><code class="descname">DistPixels</code><span class="sig-paren">(</span><em>comm=&lt;mpi4py.MPI.Intracomm object&gt;</em>, <em>size=0</em>, <em>nnz=1</em>, <em>dtype=&lt;class 'numpy.float64'&gt;</em>, <em>submap=None</em>, <em>local=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/pixels.html#DistPixels"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.DistPixels" title="Permalink to this definition">¶</a></dt>
<dd><p>A distributed map with multiple values per pixel.</p>
<p>Pixel domain data is distributed across an MPI communicator.  each
process has a local data stored in one or more &#8220;submaps&#8221;.  The size
of the submap can be tuned to balance storage (smaller submap size
means fewer wasted pixels stored) and ease of indexing (larger
submap means faster global-to-local pixel lookups).</p>
<p>Although multiple processes may have the same submap of data stored
locally, the lowest-rank process that has a given submap is the
&#8220;owner&#8221; for operations like serialization.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>comm</strong> (<em>mpi4py.MPI.Comm</em>) &#8211; the MPI communicator containing all
processes.</li>
<li><strong>size</strong> (<em>int</em>) &#8211; the total number of pixels.</li>
<li><strong>nnz</strong> (<em>int</em>) &#8211; the number of values per pixel.</li>
<li><strong>submap</strong> (<em>int</em>) &#8211; the locally stored data is in units of this size.</li>
<li><strong>local</strong> (<em>array</em>) &#8211; the list of local submaps (integers).</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="toast.map.DistPixels.comm">
<code class="descname">comm</code><a class="headerlink" href="#toast.map.DistPixels.comm" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(mpi4py.MPI.Comm)</em> &#8211; The MPI communicator used.</p>
</dd></dl>

<dl class="attribute">
<dt id="toast.map.DistPixels.dtype">
<code class="descname">dtype</code><a class="headerlink" href="#toast.map.DistPixels.dtype" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(numpy.dtype)</em> &#8211; The data type of the values.</p>
</dd></dl>

<dl class="method">
<dt id="toast.map.DistPixels.duplicate">
<code class="descname">duplicate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/pixels.html#DistPixels.duplicate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.DistPixels.duplicate" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform a deep copy of the distributed data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">A copy of the object.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">(DistPixels)</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="toast.map.DistPixels.global_to_local">
<code class="descname">global_to_local</code><span class="sig-paren">(</span><em>gl</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/pixels.html#DistPixels.global_to_local"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.DistPixels.global_to_local" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert global pixel indices into the local submap and pixel.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>gl</strong> (<em>int</em>) &#8211; The global pixel number.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A tuple containing the local submap index (int) and the
pixel index local to that submap (int).</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="toast.map.DistPixels.local">
<code class="descname">local</code><a class="headerlink" href="#toast.map.DistPixels.local" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(array)</em> &#8211; The list of local submaps or None if process has no data.</p>
</dd></dl>

<dl class="attribute">
<dt id="toast.map.DistPixels.nnz">
<code class="descname">nnz</code><a class="headerlink" href="#toast.map.DistPixels.nnz" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(int)</em> &#8211; The number of non-zero values per pixel.</p>
</dd></dl>

<dl class="attribute">
<dt id="toast.map.DistPixels.nsubmap">
<code class="descname">nsubmap</code><a class="headerlink" href="#toast.map.DistPixels.nsubmap" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(int)</em> &#8211; The number of submaps stored on this process.</p>
</dd></dl>

<dl class="attribute">
<dt id="toast.map.DistPixels.size">
<code class="descname">size</code><a class="headerlink" href="#toast.map.DistPixels.size" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(int)</em> &#8211; The global number of pixels.</p>
</dd></dl>

<dl class="attribute">
<dt id="toast.map.DistPixels.submap">
<code class="descname">submap</code><a class="headerlink" href="#toast.map.DistPixels.submap" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(int)</em> &#8211; The number of pixels in each submap.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="diagonal-noise-covariance">
<h2>Diagonal Noise Covariance<a class="headerlink" href="#diagonal-noise-covariance" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="toast.map.OpInvCovariance">
<em class="property">class </em><code class="descclassname">toast.map.</code><code class="descname">OpInvCovariance</code><span class="sig-paren">(</span><em>invnpp=None</em>, <em>hits=None</em>, <em>detweights=None</em>, <em>pixels='pixels'</em>, <em>weights='weights'</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/noise.html#OpInvCovariance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.OpInvCovariance" title="Permalink to this definition">¶</a></dt>
<dd><p>Operator which computes the diagonal inverse pixel covariance.</p>
<p>This operator requires that the local pointing matrix has already been
computed.  Each process has a local piece of the inverse covariance.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>invnpp</strong> (<a class="reference internal" href="#toast.map.DistPixels" title="toast.map.DistPixels"><em>DistPixels</em></a>) &#8211; The matrix to accumulate.</li>
<li><strong>hits</strong> (<a class="reference internal" href="#toast.map.DistPixels" title="toast.map.DistPixels"><em>DistPixels</em></a>) &#8211; (optional) the hits to accumulate.</li>
<li><strong>detweights</strong> (<em>dictionary</em>) &#8211; individual noise weights to use for each
detector.</li>
<li><strong>pixels</strong> (<em>str</em>) &#8211; the name of the cache object (&lt;pixels&gt;_&lt;detector&gt;)
containing the pixel indices to use.</li>
<li><strong>weights</strong> (<em>str</em>) &#8211; the name of the cache object (&lt;weights&gt;_&lt;detector&gt;)
containing the pointing weights to use.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="toast.map.OpInvCovariance.exec">
<code class="descname">exec</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/noise.html#OpInvCovariance.exec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.OpInvCovariance.exec" title="Permalink to this definition">¶</a></dt>
<dd><p>Iterate over all observations and detectors and accumulate.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<a class="reference internal" href="dist.html#toast.Data" title="toast.Data"><em>toast.Data</em></a>) &#8211; The distributed data.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="toast.map.covariance_invert">
<code class="descclassname">toast.map.</code><code class="descname">covariance_invert</code><span class="sig-paren">(</span><em>npp</em>, <em>threshold</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/noise.html#covariance_invert"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.covariance_invert" title="Permalink to this definition">¶</a></dt>
<dd><p>Invert the local piece of a diagonal noise covariance.</p>
<p>This does an in-place inversion of the covariance.  The threshold is
applied to the condition number of each block of the matrix.  Pixels
failing the cut are set to zero.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>npp</strong> (<em>3D array</em>) &#8211; The data member of a distributed covariance.</li>
<li><strong>threshold</strong> (<em>float</em>) &#8211; The condition number threshold to apply.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="toast.map.covariance_rcond">
<code class="descclassname">toast.map.</code><code class="descname">covariance_rcond</code><span class="sig-paren">(</span><em>npp</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/noise.html#covariance_rcond"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.covariance_rcond" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the local piece of the inverse condition number map.</p>
<p>This computes the local piece of the inverse condition number map
from the supplied covariance matrix data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>npp</strong> (<em>3D array</em>) &#8211; The data member of a distributed covariance.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>rcond</strong> &#8211;<dl class="docutils">
<dt>The local data piece of the distributed</dt>
<dd>inverse condition number map.</dd>
</dl>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">3D array</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="external-madam-interface">
<h2>External Madam Interface<a class="headerlink" href="#external-madam-interface" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="toast.map.OpMadam">
<em class="property">class </em><code class="descclassname">toast.map.</code><code class="descname">OpMadam</code><span class="sig-paren">(</span><em>params={}</em>, <em>detweights=None</em>, <em>pixels='pixels'</em>, <em>weights='weights'</em>, <em>name=None</em>, <em>purge=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/madam.html#OpMadam"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.OpMadam" title="Permalink to this definition">¶</a></dt>
<dd><p>Operator which passes data to libmadam for map-making.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>params</strong> (<em>dictionary</em>) &#8211; parameters to pass to madam.</li>
<li><strong>detweights</strong> (<em>dictionary</em>) &#8211; individual noise weights to use for each
detector.</li>
<li><strong>pixels</strong> (<em>str</em>) &#8211; the name of the cache object (&lt;pixels&gt;_&lt;detector&gt;)
containing the pixel indices to use.</li>
<li><strong>weights</strong> (<em>str</em>) &#8211; the name of the cache object (&lt;weights&gt;_&lt;detector&gt;)
containing the pointing weights to use.</li>
<li><strong>name</strong> (<em>str</em>) &#8211; the name of the cache object (&lt;name&gt;_&lt;detector&gt;) to
use for the detector timestream.  If None, use the TOD.</li>
<li><strong>purge</strong> (<em>bool</em>) &#8211; if True, clear any cached data that is copied intersection
the Madam buffers.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="toast.map.OpMadam.available">
<code class="descname">available</code><a class="headerlink" href="#toast.map.OpMadam.available" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(bool)</em> &#8211; True if libmadam is found in the library search path.</p>
</dd></dl>

<dl class="method">
<dt id="toast.map.OpMadam.exec">
<code class="descname">exec</code><span class="sig-paren">(</span><em>data</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/toast/map/madam.html#OpMadam.exec"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#toast.map.OpMadam.exec" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy data to Madam-compatible buffers and make a map.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>data</strong> (<a class="reference internal" href="dist.html#toast.Data" title="toast.Data"><em>toast.Data</em></a>) &#8211; The distributed data.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="toast.map.OpMadam.timedist">
<code class="descname">timedist</code><a class="headerlink" href="#toast.map.OpMadam.timedist" title="Permalink to this definition">¶</a></dt>
<dd><p><em>(bool)</em> &#8211; Whether this operator requires data that time-distributed.</p>
</dd></dl>

</dd></dl>

</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="sim.html">Simulations</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="nersc.html">Using at NERSC</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &copy; Copyright 2015-2016, Theodore Kisner, Reijo Keskitalo.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>